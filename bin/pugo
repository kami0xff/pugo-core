#!/usr/bin/env php
<?php
/**
 * Pugo CLI - Command Line Interface
 * 
 * Usage: ./pugo [command] [options]
 * Run './pugo help' for available commands.
 */

// Find autoloader
$autoloaders = [
    __DIR__ . '/../autoload.php',              // Inside pugo-core
    __DIR__ . '/../../autoload.php',           // Vendor directory  
    __DIR__ . '/../vendor/autoload.php',       // Standalone
    getcwd() . '/admin/core/autoload.php',     // From project root
];

$autoloaderFound = false;
foreach ($autoloaders as $autoloader) {
    if (file_exists($autoloader)) {
        require_once $autoloader;
        $autoloaderFound = true;
        break;
    }
}

if (!$autoloaderFound) {
    // Try to load directly
    $coreDir = dirname(__DIR__);
    if (file_exists($coreDir . '/autoload.php')) {
        require_once $coreDir . '/autoload.php';
    } else {
        echo "Error: Could not find Pugo autoloader.\n";
        exit(1);
    }
}

// Determine project root
$projectRoot = getcwd();

// Check for HUGO_ROOT env var
if (getenv('HUGO_ROOT')) {
    $projectRoot = getenv('HUGO_ROOT');
}

// Define constants if not already defined
if (!defined('HUGO_ROOT')) {
    define('HUGO_ROOT', $projectRoot);
}
if (!defined('PUGO_ROOT')) {
    define('PUGO_ROOT', $projectRoot . '/admin');
}

use Pugo\CLI\PugoCLI;

$cli = new PugoCLI($projectRoot);
exit($cli->run($argv));

